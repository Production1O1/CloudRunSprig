const Smug = "i";
const player = "p";
const c = "x";
const bg = "O";
const ms = "9";
const tl = "6";
const pp = "b";
const ll = "u";
const uy = "j";
const yiu = "q";
const huhu = "k";
const opo = "m";
const iml = "a";
const okl = "r";
const jky = "f";

const melody = tune`
37.5: B5^37.5 + A5^37.5 + G5^37.5 + F5^37.5 + G4^37.5,
37.5: B5-37.5 + A5-37.5 + G5-37.5 + F5-37.5 + E5-37.5,
37.5: B4^37.5 + A4^37.5 + G4^37.5 + D5~37.5 + E5~37.5,
37.5: D5~37.5 + C5~37.5 + B4~37.5 + A4~37.5 + G4~37.5,
1050` 

setLegend(
[ player, bitmap`
................
................
....0000000.....
...007777700....
..00777777700...
.0077077077700..
.0777277277770..
.0777277277770..
.077727727755599
.07772772775559.
.0777777775550..
.0000000055500..
...0.....55.....
...0......0.....
55.0......0..55.
57777....777775.` ],
  [Smug, bitmap`
................
......0000......
.....000000.....
....0030030.....
....0000000.....
.....000000.....
.....LLLLLL.....
...LLLLL........
...LLLLLL..11111
...L.LLLLL011111
...00LLL...11...
.....LLL....1...
.....00.........
.....000........
....000000......
...000.000......`],
  [c, bitmap`
0000000000000000
0000000007777777
0000007777222227
0000777222227777
0000722277777555
0007727755555500
0007227550000000
0007275500000000
0007275000000000
0007275500000000
0007277550000000
0007227755555550
0007222777777755
0007772222222777
0000077777222227
0000000007777777`],
   [bg, bitmap`
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000`],
   [ms, bitmap`
0000055550000000
0000077750000000
0000072750000000
0000072750000000
0000072750000000
0000072750000000
0000072750000000
0000072750000000
0000072750000000
0000072750000000
0000072750000000
0000072750000000
0000072755555555
0000072777777775
0000072222222275
0000077777777775`],
   [tl, bitmap`
0000000000000000
0000077777770000
0000772222270000
0007722777270000
0077227757277000
0072277557227000
0722775507727700
0727755000722700
0727550000072700
0727500000072700
0727555000772700
0727775555722700
0722277777722700
0772222222227700
0077777722277000
0000077777770000`],
   [pp, bitmap`
0000000000000000
0007775000577700
0007275000572700
0007275000572700
0007275000572700
0007275000572700
0007275500572700
0007277500572700
0007227500572700
0007727550572700
0000727755572700
0000722775772700
0000772277727700
0000077222227000
0000007772777000
0000000077700000`],
   [ll, bitmap`
0000000000000000
0007777770000000
0007222277770000
0007277222270000
0007275777277000
0007275507227000
0007275507227000
0007275507227000
0007275507227000
0007275507727000
0007275500727000
0007275507727000
0007275777227000
0007277722277000
0007222227770000
0007777777000000`],
   [uy, bitmap`
0000000000000000
5000000000000000
0577777777777500
5755557222227500
0500057277727500
0000057270727500
0000057277227500
0000057222275500
0000057227555000
0000057777550000
0000057007755000
0000057000775500
0000057000077500
5555557000007550
5757777000007750
5070000000000000`],
   [yiu, bitmap`
0007775000777755
0007777700777550
0007227500727500
0007277500727000
0007275500727000
0007275000727000
0007275000727000
0007275000727000
0007275000727000
0007275000727000
0007275057727000
0007275557227000
0007277777277000
0007222222270000
0007772227700000
0000077777000000`],
  [huhu, bitmap`
7777777777777700
722.227727770000
7222227727700000
7277727727000000
7275722727000000
7275772727000000
7275572227000000
7275072227000000
7275077227000000
7275007227000000
7275007227000000
7275007727000000
7275007727000000
7275000727000000
72750007.7000000
7775000777000000`],
  [opo, bitmap`
0000000000000000
0005555555555000
0055777777775500
0557777777777550
0577707777077750
0577727777277750
0577727777277750
0577727777277750
0577727777277750
0577777777777750
0555555555555550
0000500000050000
0000500000050555
0000500005555555
5500500001LLL100
555555000L1LLL10`],
  [iml, bitmap`
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000440440000
000L0000C0C00004
00LL440CCCCCCCC4
0L5L344C4C4C0000
0L5L444CCC4C0000
0L2L34444CCCCCC4
0L5L444CCC4C0004
0LLL44L7L11L0000
00000LLLLL1LL000
0000L7L171LLL700
000LL1LLL11L7LL0`],
  [okl, bitmap`
0000007777777000
0000777777777700
0007777555577700
0007775555577700
0077775555577770
0077755577557770
0077555577555777
0075557772775777
0075555722275577
0077755772775577
0077755577755777
0007755577555777
0007775555557777
0000777777777770
0000777777777700
0000000077700000`],
  [jky, bitmap`
.......55.......
....55555555....
...5555555555...
...5557777555...
..555777777555..
..555777777555..
.55577777777555.
.55777722777755.
5557772772777555
5557772772777555
5557772772777555
.55777277277755.
.55577722777555.
.55577777777555.
..555555555555..
...5555555555...`],
);

const levels = [
  map`
  rOrx96burOr
  OaOOOOOOOmO
  OOrOjqkOrOO`,
  map`
  ......................
  ......................
  ......i...............
  ..........i...........
  ......................
  ..................i...
  f...i.....i...........
  .....................p
  ..........i...........
  ......................
  ..........i...........
  ..................i...
  ......i...............
  ..........i...........
  ......................`,
  map`...`,
  map`...`,
];

let level = 0;

const currentLevel = levels[level];
setMap(currentLevel);

setPushables({
  [player]: []
});

onInput("s", () => {
  getFirst(player).y += 1;
  checkNextLevel();
  playTune(melody);
});

onInput("w", () => {
  getFirst(player).y -= 1;
  checkNextLevel();
  playTune(melody);
});

onInput("a", () => {
  getFirst(player).x -= 1;
  checkNextLevel();
  playTune(melody);
});

onInput("d", () => {
  getFirst(player).x += 1;
  checkNextLevel();
  playTune(melody);
});

function checkNextLevel() {
  const playerTile = getTile(getFirst(player).x, getFirst(player).y);
  if (playerTile.some(sprite => sprite.type === "jky")) {
    if (level === 1) {
      level = 2;  // Transition from level 1 to level 2
      setMap(levels[level]);
    }
    // No level transition if not in level 1
  }
}
